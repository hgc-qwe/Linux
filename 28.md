# 总结

## 进程记账

1.定义：内核会在每个进程终止时，将一条关于该进程资源使用情况写入一个指定的系统级文件
2.目的：主要用于系统管理、审计、计费和性能分析
3.启用与使用：

- 通常通过`accton`命令或在启动脚本中调用`acct()`系统调用来启用/禁用。
- 记账文件通常位于`/var/account/pacct`或类似路径。
- 使用工具（如`sa`, `lastcomm`）来读取和分析这个二进制格式的记账文件。

4.记账记录包含的内容：

- 进程标识：PID，PPID，用户ID和组ID。
- 执行时间：用户态和内核态的CPU时间。
- 资源使用：内存使用情况、I/O操作计数、块传输数等。
- 终端信息：进程关联的终端。
- 退出状态：进程终止状态和信号。
- 命令名：执行程序的名称

## `clone()`系统调用

1.与`fork()`的区别：`fork()`复制大多数资源，`clone()`精确控制共享哪些资源
2.共享标志：

- `CLONE_VM`：共享内存空间（页表）。父子进程运行在同一个虚拟地址空间中（即共享全局变量、堆、代码段）。
- `CLONE_FS`：共享文件系统信息（如根目录、当前工作目录）。
- `CLONE_FILES`：共享文件描述符表。
- `CLONE_SIGHAND`：共享信号处理函数表。
- `CLONE_THREAD`：将新“进程”置于与调用者相同的线程组中。（共享TGID）

```c
int clone(int (*fn)(void *), void *child_stack,
          int flags, void *arg, ...
          /* pid_t *ptid, struct user_desc *tls, pid_t *ctid */ );
```

3.线程就是一个与其他进程共享了大部分资源（特别是内存空间）的“轻量级进程”
