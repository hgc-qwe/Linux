# 思考题

## 硬链接 vs 软链接

### 总结提到硬链接和软链接的区别

#### 创建一个文件 file.txt，内容为 "hello"。创建它的硬链接 hardlink.txt 和软链接 softlink.txt。然后

##### 删除原文件 file.txt，hardlink.txt 和 softlink.txt 分别会怎样？

hardlink.txt仍然可以正常访问文件，该文件的链接计数从2变为1。softlink.txt变为悬空链接。

##### 修改 hardlink.txt 的内容为 "world"，然后用 cat 查看 file.txt（如果还存在）会看到什么？

修改任何一个硬链接，所有链接都会看到变化。

##### 分别用 stat 和 ls -l 查看两种链接，输出有什么不同？

- 硬链接共享 i-node，符号链接有自己的 i-node
- ls显示硬链接为‘-’，符号链接为‘l’
- 符号链接显示全 rwx，硬连接显示实际权限
- stat 获取符号链接目标信息，ls 显示符号链接信息

## 目录操作与链接计数

### 总结提到 i-node 的链接计数

#### 创建目录 mydir，初始链接计数是多少？为什么？

父目录有一个条目指向 mydir 的 i-node，mydir目录内部有一个"."条目指向自身

#### 在 mydir 中创建子目录 subdir 后，mydir 的链接计数会变成多少？为什么？

subdir 目录内部的".."指向 mydir

#### 什么是 .（点）和 ..（点点）链接？它们在链接计数中起什么作用？

指向当前目录和父目录的硬链接

## 符号链接的解引用

### 总结提到有些系统调用会自动解引用符号链接，有些则不会

#### stat("symlink", &sb) 和 lstat("symlink", &sb) 有什么区别？

stat对符号链接解引用，lstat不解引用

#### 编写程序测试：对符号链接使用 open()、readlink()、unlink()，这些函数分别会操作链接本身还是目标文件？

open操作目标文件，readlink获取链接内容，unlink删除链接

## 目录遍历与路径解析

### 总结提到 nftw()、realpath()、dirname()/basename()

#### realpath() 函数如何处理包含 ../、./ 和符号链接的路径？

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/2d5821add6eb4c4eb6d3e9b2161e14c1.png#pic_center)

#### 路径 /home/user/docs/../code/./file.txt 经过 realpath() 规范化后会变成什么？

- 起始: /home/user/docs/../code/./file.txt
- 如果是符号链接，解引用docs
- 处理 .. : 删除前一个组件docs  -> /home/user/../code/./file.txt
- 再次处理 .. : 删除user  -> /home/../code/./file.txt  
- 再次处理 .. : 删除home  -> /code/./file.txt
- 处理 . : 删除  -> /code/file.txt
- 结果: /code/file.txt
